<span style="font-family: verdana, geneva, sans-serif;">
  <!DOCTYPE html>
  <html lang="en">

  <head>
    <meta charset="utf-8" initial-scale=0.5>
    <title>Dashboard Planejamento</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='/css/index_novo.css') }}">
    <script src="{{url_for('static', filename='/js/index.js')}}"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="icon" type="image/jpg" href="{{ url_for('static', filename='/img/alaresVERDE.png') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src='https://cdn.plot.ly/plotly-2.27.0.min.js'></script>
    <script src="https://code.jquery.com/jquery-3.7.1.slim.js" integrity="sha256-UgvvN8vBkgO0luPSUl2s8TIlOSYRoGFAX4jlCIm9Adc=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <!--CSS-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">

    <!--JS-->
    <script src="{{url_for('static', filename='/assets/js/color-modes.js')}}"></script>
    <script src="{{url_for('static', filename='/assets/dist/js/bootstrap.bundle.min.js')}}"></script>


    <!--Tabela-->
    <link href="//cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="//cdn.datatables.net/select/1.3.3/css/select.dataTables.min.css" rel="stylesheet">
    
  </head>

  <body>
    <div class="container">
      <nav>
        <ul>
          <li><a href="#" class="logo">
              <img src="/static/img/pngwing.com.png" alt="" style="    border: 3px solid #6b50ff;border-radius: 50%;">
              <span class="nav-item" style="color: #6b50ff;">DashBoard</span>
            </a></li>
          <li><a href="home" target="_blank">
              <i class="fas fa-home"></i>
              <span class="nav-item">Home</span>
            </a></li>
          <li><a href="painelVoz" target="_blank">
              <i class="fas fa-chart-line"></i>
              <span class="nav-item">Dash</span>
            </a></li>
          <li><a href="mapa" target="_blank">
              <i class="fas fa-map-location-dot"></i>
              <span class="nav-item">Mapa</span>
            </a></li>
          <li><a href="/" target="_blank">
              <i class="fas fa-circle-exclamation"></i>
              <span class="nav-item">Massivas</span>
            </a></li>
          <li><a href="clientesUSO" target="_blank">
              <i class="fas fa-comment"></i>
              <span class="nav-item">Sent. CHAT</span>
            </a></li>
          <li><a href="encerramentoUSO" target="_blank">
              <i class="fas fa-cog"></i>
              <span class="nav-item">Enc. CHAT</span>
            </a></li>
            <li><a href="mapaUSO" target="_blank">
              <i class="fas fa-map-location-dot"></i>
              <span class="nav-item">Mapa. CHAT</span>
            </a></li>
          <li><a href="">
              <i class="fas fa-question-circle"></i>
              <span class="nav-item">Help</span>
            </a></li>
          <li><a href="" class="logout">
              <i class="fas fa-sign-out-alt"></i>
              <span class="nav-item">Log out</span>
            </a></li>
        </ul>
      </nav>

      <section class="main">
        <div class="main-top">
          <h1 style="font-size: 20px; color:#6b50ff;">Control Desk</h1>
          <i class="fas fa-user-cog"></i>
        </div>

        <div class="main-skills">

          <div class="card">
            <img src="/static/img/customer-service.png" alt="" srcset="" style="width: 45px; height: 45px;">
            <h3>RECEBIDAS</h3>
            <h3 id="valor_recebidas">0</h3>
            <div style="display: flex; justify-content: center; font-size: 15px;">
            <h4>HD: </h4><div id="total_consolidadoHD"> 0</div></div>
            <div style="display: flex; justify-content: center; font-size: 15px;">
            <h4>SAC: </h4><div id="total_consolidadoSAC"> 0</div></div>
            <div style="display: flex; justify-content: center; font-size: 15px;">
              <h4>WEBBY: </h4><div id="total_consolidadoWEBBY"> 0</div></div>
          </div>

          <div class="card">
            <img src="/static/img/customer-service2.png" alt="" srcset="" style="width: 45px; height: 45px;">
            <h3>ATENDIDAS</h3>
            <h3 id="valor_atendidas">0</h3>
            <div id="atendidas_consolidadoHD">0</div>
            <div id="atendidas_consolidadoSAC">0</div>
            <div id="atendidas_consolidadoWEBBY">0</div>
          </div>
          <div class="card">
            <img src="/static/img/customer-support.png" alt="" srcset="" style="width: 45px; height: 45px;">
            <h3>ABANDONADAS</h3>
            <h3 id="valor_aband">0</h3>
            <div id="abandonadas_consolidadoHD">0</div>
            <div id="abandonadas_consolidadoSAC">0</div>
            <div id="abandonadas_consolidadoWEBBY">0</div>

          </div>
          <div class="card">
            <img src="/static/img/customer-support.png" alt="" srcset="" style="width: 45px; height: 45px;">
            <h3>PCA(%)</h3>
            <h3 id="valor_pca">0</h3>
            <div id="pca_consolidadoHD">0</div>
            <div id="pca_consolidadoSAC">0</div>
            <div id="pca_consolidadoWEBBY">0</div>
          </div>

          <div class="card">
            <img src="/static/img/hotline.png" alt="" srcset="" style="width: 45px; height: 45px;">
            <h3>TME</h3>
            <h3 id="valor_tme">00:00:00</h3>
            <div id="tme_consolidadoHD">00:00:00</div>
            <div id="tme_consolidadoSAC">00:00:00</div> 
            <div id="tme_consolidadoWEBBY">00:00:00</div>             
          </div>

          <div class="card">
            <img src="/static/img/customer-service (1).png" alt="" srcset="" style="width: 45px; height: 45px;">
            <h3>TMA</h3>
            <h3 id="valor_tma">00:00:00</h3>
            <div id="tma_consolidadoHD">00:00:00</div>
            <div id="tma_consolidadoSAC">00:00:00</div>
            <div id="tma_consolidadoWEBBY">00:00:00</div>    
            </div> 
        </div>

        <section class="main-course">
          <h1>REAL TIME - FILAS</h1>
          <button class="btn btn-primary" onclick="update_filas()" style="background-color: #9e8dff; padding: 10px; border-radius: 10px; cursor: pointer; font-size: 10px;"> VOZ </button>
          <button class="btn btn-primary" onclick="chat()" style="background-color: #9e8dff; padding: 10px; border-radius: 10px; cursor: pointer; font-size: 10px;"> CHAT </button>

          <div class="main-skills">

            <div class="card">
              <img src="/static/img/customer-service.png" alt="" srcset="" style="width: 35px; height: 35px;">
              <h3>ESPERA VOZ</h3>
              <h3 id="valor_espera">0</h3>

            </div>

            <div class="card">
              <img src="/static/img/customer-service2.png" alt="" srcset="" style="width: 35px; height: 35px;">
              <h3>ATEND. VOZ</h3>
              <h3 id="valor_chamando">0</h3>

            </div>

            <div class="card">
              <img src="/static/img/vetor-1.png" alt="" srcset="" style="width: 35px; height: 35px;">
              <h3>ESPERA CHAT</h3>
              <h3 id="chatTotal">0</h3>

            </div>

            <div class="card">
              <h2 style="color: #6b50ff;font-size: 20px; margin-bottom: 14px;">WEBBY</h2>
              <h3>ESPERA CHAT</h3>
              <h3 id="chatTME">0</h3>

            </div>

            <div class="card">
              <h2 style="font-size: 20px; margin-bottom: 14px;color: #6b50ff">ALARES / WEBBY</h2>
              <h3>CHAT - LOG. / DISP. </h3>

              <div style="display: flex; justify-content: center; align-items: center;">
                <h4 id="chatTotalLogados">0</h4> / <h4 id="chatDispo">0</h4>
              </div>

              <div style="display: flex; justify-content: center; align-items: center;">
                <h4 id="chatTotalLogados2">0</h4> / <h4 id="chatDispo2">0</h4>
              </div>
            </div>
          </div>
        </section>

        <section class="main-course">
          <h1>VOLUMETRIA E BLOQUEIOS</h1>
          <button class="btn btn-primary" onclick="updateGrafico()" style="background-color: #9e8dff; padding: 10px; border-radius: 10px; cursor: pointer; font-size: 10px;"> Volume </button>
          <button class="btn btn-primary" onclick="demanda()" style="background-color: #9e8dff; padding: 10px;border-radius: 10px; cursor: pointer;font-size: 10px;"> Bloqueios </button>
          <div class="course-box">
            <div class="course">
              <div class="box1">
              <div id="render_grafico">
              </div>
              </div>
              <div class="box">

                <div id='myDiv'>

                </div>

              </div>
            </div>
          </div>
        </section>
        <section class="main-course">
          <h1>ALERTAS</h1>
          <!--
          <button class="btn btn-primary" onclick="escalados()" style="background-color: #9e8dff; padding: 10px; border-radius: 10px; cursor: pointer; font-size: 10px;"> ABS </button>
          <button class="btn btn-primary" onclick="B2BB()" style="background-color: #9e8dff; padding: 10px; border-radius: 10px; cursor: pointer; font-size: 10px;"> B2B </button>
          -->
          <button class="btn btn-primary" onclick="alertas()" style="background-color: #9e8dff; padding: 10px; border-radius: 10px; cursor: pointer; font-size: 10px;"> ALERTAS </button>
          
          <div class="course-box">
            <div class="course">
              <!--
              <div class="box">
                <table id="tbody" class="table sortable" style="text-align: center">
                  <thead style="font-size: 12px;">
                    <tr>
                      <th>Setor</th>
                      <th>Escalados</th>
                      <th>Logados</th>
                      <th>Abd (%)</th>
                      <th>Atualização</th>
                    </tr>
                  </thead>
                  <tbody style="font-size: 12px;">

                  </tbody>
                </table>
              </div>
            -->
              <div class="box2">
                <table id="tbody2" class="table sortable" style="text-align: center">
                  <thead style="font-size: 12px;">
                    <tr>
                      <th>RUIE</th>
                      <th>Clientes Impactados</th>
                      <th>Cidades</th>
                    </tr>
                  </thead>
                  <tbody style="font-size: 12px;">

                  </tbody>
                </table>
              </div>

            </div>
          </div>
        </section>
        <!--
        <section class="main-course">
          <h1>PRODUTIVIDADE CHAT</h1>
          <button class="btn btn-primary" onclick="pausachat()" style="background-color: #9e8dff; padding: 10px; border-radius: 10px; cursor: pointer; font-size: 10px;"> USO </button>
          <div class="course-box">
            <div class="course">
              <table id="tbody1" class="sortable table table-striped table-bordered nowrap" style="text-align: center;">
                <thead style="font-size: 12px;">
                  <tr>
                    <th>Data</th>
                    <th>Usuário</th>
                    <th>Login</th>
                    <th>Logout</th>
                    <th data-toggle="tooltip" title="Tempo disponível na tela de chat">Tempo Disponível</th>
                    <th data-toggle="tooltip" title="Tempo indisponível na tela de chat">Tempo Pausa</th>
                    <th data-toggle="tooltip" title="Usuário dentro da plataforma">Logado</th>
                    <th data-toggle="tooltip" title="Disponibilidade na tela de chat">Disponível</th>
                    <th data-toggle="tooltip" title="Disponibilidade na tela de chat">Dif</th>

                  </tr>
                </thead>
                <tfoot>
                  <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                  </tr>
                </tfoot>
                <tbody style="font-size: 12px;">

                </tbody>
              </table>
            </div>
          </div>
        </section>
    </div>
-->
  </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.slim.js"
      integrity="sha256-UgvvN8vBkgO0luPSUl2s8TIlOSYRoGFAX4jlCIm9Adc=" crossorigin="anonymous"></script>
    <script src="//cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>

    <script>
      $(document).ready(function () {
        $('#tbody').DataTable({
          "language": {
            "sEmptyTable": "Nenhum registro encontrado",
            "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
            "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
            "sInfoFiltered": "(Filtrados de _MAX_ registros)",
            "sInfoPostFix": "",
            "sInfoThousands": ".",
            "sLengthMenu": "Mostrar _MENU_ resultados por página",
            "sLoadingRecords": "Carregando...",
            "sProcessing": "Processando...",
            "sZeroRecords": "Nenhum registro encontrado",
            "sSearch": "Pesquisar",
            "oPaginate": {
              "sNext": "Próximo",
              "sPrevious": "Anterior",
              "sFirst": "Primeiro",
              "sLast": "Último"
            },
            "oAria": {
              "sSortAscending": ": Ordenar colunas de forma ascendente",
              "sSortDescending": ": Ordenar colunas de forma descendente"
            },
            "select": {
              "rows": {
                "_": "Selecionado %d linhas",
                "0": "Nenhuma linha selecionada",
                "1": "Selecionado 1 linha"
              }
            }
          }
        });
      });
    </script>

    <script>
      $(document).ready(function () {
        var table = $('#tbody1').DataTable({
          "language": {
            "sEmptyTable": "Nenhum registro encontrado",
            "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
            "sInfoPostFix": "",
            "sInfoThousands": ".",
            "sLengthMenu": "Mostrar _MENU_ resultados por página",
            "sLoadingRecords": "Carregando...",
            "sProcessing": "Processando...",
            "sZeroRecords": "Nenhum registro encontrado",
            "sSearch": "Pesquisar",
            "oPaginate": {
              "sNext": "Próximo",
              "sPrevious": "Anterior",
              "sFirst": "Primeiro",
              "sLast": "Último"
            },
            "oAria": {
              "sSortAscending": ": Ordenar colunas de forma ascendente",
              "sSortDescending": ": Ordenar colunas de forma descendente"
            },
            "select": {
              "rows": {
                "_": "Selecionado %d linhas",
                "0": "Nenhuma linha selecionada",
                "1": "Selecionado 1 linha"
              }
            }
          },
          initComplete: function () {
            // Adiciona os filtros nas colunas especificadas
            this.api().columns([4, 5, 6, 7]).every(function () {
              var column = this;
              var input = $('<input type="text" placeholder="Filtrar ' + $(column.header()).text() + '" />')
                .appendTo($(column.footer()).empty())
                .on('keyup change clear', function () {
                  if (column.search() !== this.value) {
                    column.search(this.value).draw();
                  }
                });
            });
          }
        });
      });
    </script>

    <script>
      $(document).ready(function () {
        $('#tbody2').DataTable({
          "language": {
            "sEmptyTable": "Nenhum registro encontrado",
            "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
            "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
            "sInfoFiltered": "(Filtrados de _MAX_ registros)",
            "sInfoPostFix": "",
            "sInfoThousands": ".",
            "sLengthMenu": "Mostrar _MENU_ resultados por página",
            "sLoadingRecords": "Carregando...",
            "sProcessing": "Processando...",
            "sZeroRecords": "Nenhum registro encontrado",
            "sSearch": "Pesquisar",
            "oPaginate": {
              "sNext": "Próximo",
              "sPrevious": "Anterior",
              "sFirst": "Primeiro",
              "sLast": "Último"
            },
            "oAria": {
              "sSortAscending": ": Ordenar colunas de forma ascendente",
              "sSortDescending": ": Ordenar colunas de forma descendente"
            },
            "select": {
              "rows": {
                "_": "Selecionado %d linhas",
                "0": "Nenhuma linha selecionada",
                "1": "Selecionado 1 linha"
              }
            }
          }
        });
      });
    </script>

<!--=====================================================================-->
<script>
const Toast = Swal.mixin({
  toast: true,
  position: 'top-end',
  showConfirmButton: false,
  timer: 5000,
  timerProgressBar: true,
  didOpen: (toast) => {
    toast.addEventListener('mouseenter', Swal.stopTimer);
    toast.addEventListener('mouseleave', Swal.resumeTimer);
  }
});

function showAlert(message, options) {
  return Swal.fire({
    title: message,
    ...options,
    position: 'center', // Centraliza na página
    showCloseButton: true,
    customClass: {
      popup: 'custom-popup' // Classe personalizada para o popup
    }
  });
}

function showAlert1(valor) {
  return showAlert(`Valor está estável/subindo - ${valor}%`, {
    icon: 'info',
    html: '<div class="alert-content"><img src="/static/img/Animation - 1724682744110.gif" alt=""></div>',
  });
}

function showAlert3() {
  return showAlert('Atenção ao tamanho da FILA NO VOZ, o valor está subindo!', {
    icon: 'warning',
    html: '<div class="alert-content"><img src="/static/img/Animation - 1724682617950.gif"></div>',
  });
}

function showAlert4() {
  return showAlert('Atenção ao tamanho da FILA NO CHAT, o valor já ultrapassou 100 clientes e está subindo!', {
    icon: 'warning',
    html: '<div class="alert-content"><img src="/static/img/Animation - 1724682617950.gif"></div>',
  });
}

function showAlert5() {
  return showAlert('Atenção ao tamanho da FILA NO CHAT, o valor já ultrapassou <span style="color: red;">50</span> clientes e está subindo!', {
    icon: 'warning',
    html: '<div class="alert-content"><img src="/static/img/Animation - 1724683417469.gif"></div>',
  });
}

function showAlert6() {
  return showAlert('Atenção ao tamanho da FILA NO CHAT, o valor já ultrapassou <span style="color: red;">150</span> clientes e está subindo!', {
    icon: 'warning',
    html: '<div class="alert-content"><img src="/static/img/l1Et1g3ReLJ8zfEVq.gif"></div>',
  });
}

let valorAnteriorPca = null;
let valorAnteriorEsperaVoz = null;
let valorAnteriorChat = null;

function atualizarLocalStorage(chave, valor) {
  const vetor = JSON.parse(localStorage.getItem(chave)) || [];
  vetor.push(valor);
  localStorage.setItem(chave, JSON.stringify(vetor));
}

function calcularMediaMovel() {
  const vetorPca = JSON.parse(localStorage.getItem("valor_pca")) || [];
  if (vetorPca.length < 3) return;

  const mediaMovel =
    (parseFloat(vetorPca[vetorPca.length - 1]) +
     parseFloat(vetorPca[vetorPca.length - 2]) +
     parseFloat(vetorPca[vetorPca.length - 3])) / 3;

  const valorMaisRecente = parseFloat(vetorPca[vetorPca.length - 1]);
  if (mediaMovel < valorMaisRecente) {
    showAlert(valorMaisRecente, {
      icon: 'warning',
      html: '<div>PCA está subindo!</div>'
    });
  } else {
    showAlert1(valorMaisRecente);
  }
}

function filavoz() {
  const vetorEsperaVoz = JSON.parse(localStorage.getItem("espera_voz")) || [];
  if (vetorEsperaVoz.length > 0 && parseInt(vetorEsperaVoz[vetorEsperaVoz.length - 1]) >= 40) {
    showAlert3();
  }
}

function filachat() {
  const vetorChat = JSON.parse(localStorage.getItem("espera_chat")) || [];
  if (vetorChat.length > 0) {
    const valorAtual = parseInt(vetorChat[vetorChat.length - 1]);
    
    // Cálculo da taxa de crescimento médio
    let taxaCrescimento = 0;
    if (vetorChat.length > 1) {
      const ultimosValores = vetorChat.slice(-5); // Pega os últimos 5 valores
      const diferencas = [];
      for (let i = 1; i < ultimosValores.length; i++) {
        diferencas.push(parseInt(ultimosValores[i]) - parseInt(ultimosValores[i-1]));
      }
      taxaCrescimento = diferencas.reduce((a, b) => a + b, 0) / diferencas.length;
    }

    if (valorAtual >= 150) {
      showAlert6();
      return;
    } 
    if (valorAtual >= 100) {
      showAlert4(taxaCrescimento);
      return;
    } 
    if (valorAtual >= 50) {
      showAlert5();
      return;
    } 
  }
}

// Modifique a função showAlert4 para receber e exibir a taxa de crescimento
function showAlert4(taxaCrescimento) {
  return showAlert(`Atenção ao tamanho da FILA NO CHAT, o valor já ultrapassou 100 clientes e está subindo!<br>Taxa de crescimento médio: ${taxaCrescimento.toFixed(2)} clientes/atualização`, {
    icon: 'warning',
    html: '<div class="alert-content"><img src="/static/img/Animation - 1724682617950.gif"></div>',
  });
}

// Funções de monitoramento
function monitorarVariavelPca(mutations) {
  mutations.forEach(mutation => {
    const valorPca = mutation.target.textContent;
    if (valorPca !== valorAnteriorPca) {
      valorAnteriorPca = valorPca;
      atualizarLocalStorage("valor_pca", valorPca);
      calcularMediaMovel();
    }
  });
}

function monitorarVariavelEsperaVoz(mutations) {
  mutations.forEach(mutation => {
    const valorEsperaVoz = mutation.target.textContent;
    if (valorEsperaVoz !== valorAnteriorEsperaVoz) {
      valorAnteriorEsperaVoz = valorEsperaVoz;
      atualizarLocalStorage("espera_voz", valorEsperaVoz);
      filavoz();
    }
  });
}

function monitorarVariavelChat(mutations) {
  mutations.forEach(mutation => {
    const valorChat = mutation.target.textContent;
    if (valorChat !== valorAnteriorChat) {
      valorAnteriorChat = valorChat;
      atualizarLocalStorage("espera_chat", valorChat);
      filachat();
    }
  });
}

// Criando os Mutation Observers
const observerPca = new MutationObserver(monitorarVariavelPca);
const observerEsperaVoz = new MutationObserver(monitorarVariavelEsperaVoz);
const observerChat = new MutationObserver(monitorarVariavelChat);

// Configurações do observer
const config = {
  childList: true,
  subtree: true,
  characterData: true,
};

// Observando os elementos desejados
observerPca.observe(document.getElementById("valor_pca"), config);
observerEsperaVoz.observe(document.getElementById("valor_espera"), config);
observerChat.observe(document.getElementById("chatTotal"), config);

// CSS personalizado
const style = document.createElement('style');
style.innerHTML = `
  .custom-popup {
    width: 800px; /* Ajuste a largura conforme necessário */
    heigh: 500px;
    padding: 20px; /* Ajuste o padding conforme necessário */
    font-size: 16px; /* Ajuste o tamanho da fonte, se necessário */
    border-radius: 10px; /* Bordas arredondadas */
    display: flex; /* Flexbox para centralização */
    justify-content: center; /* Centraliza horizontalmente */
    align-items: center; /* Centraliza verticalmente */
    flex-direction: column; /* Alinha itens em coluna */
  }
  
  .alert-content {
    display: flex; /* Flexbox para centralizar a animação */
    justify-content: center; /* Centraliza horizontalmente */
    align-items: center; /* Centraliza verticalmente */
    width: 100%; /* Garante que ocupe toda a largura do popup */
  }
`;
document.head.appendChild(style);
</script>

  </body>

  </html>
</span>